{"version":3,"sources":["auto-reload.js","app.js"],"names":[],"mappings":"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","file":"public/app.js","sourcesContent":["/* jshint ignore:start */\n(function() {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = (window.brunch || {});\n  var ar = br['auto-reload'] = (br['auto-reload'] || {});\n  if (!WebSocket || ar.disabled) return;\n\n  var cacheBuster = function(url){\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') +'cacheBuster=' + date;\n  };\n\n  var browser = navigator.userAgent.toLowerCase();\n  var forceRepaint = ar.forceRepaint || browser.indexOf('chrome') > -1;\n\n  var reloaders = {\n    page: function(){\n      window.location.reload(true);\n    },\n\n    stylesheet: function(){\n      [].slice\n        .call(document.querySelectorAll('link[rel=stylesheet]'))\n        .filter(function(link) {\n          var val = link.getAttribute('data-autoreload');\n          return link.href && val != 'false';\n        })\n        .forEach(function(link) {\n          link.href = cacheBuster(link.href);\n        });\n\n      // Hack to force page repaint after 25ms.\n      if (forceRepaint) setTimeout(function() { document.body.offsetHeight; }, 25);\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname || 'localhost';\n\n  var connect = function(){\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function(event){\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function(){\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function(){\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n/* jshint ignore:end */","let Marvel = {\n  init() {\n    this.search = instantsearch({\n      appId: 'O3F8QXYK6R',\n      apiKey: '78e45b023b7ff7d8ba88c59c9db19890',\n      indexName: 'marvel',\n      urlSync: true,\n      searchFunction: (helper) => {\n        // Reset the lazyloadCounter\n        Marvel.lazyloadCounter = 0;\n        helper.search();\n      }\n    });\n\n    this.search.on('render', this.onRender);\n\n    this.addSearchBoxWidget();\n    this.addStatsWidget();\n    this.addTeamsWidget();\n    this.addAuthorsWidget();\n    this.addPowersWidget();\n    this.addSpeciesWidget();\n    this.addHitsWidget();\n    this.addPaginationWidget();\n    this.addRefinementList();\n\n    this.addOpenProfile();\n\n    this.search.start();\n  },\n  cloudinary(url, options) {\n    let baseUrl = 'http://res.cloudinary.com/pixelastic-marvel/image/fetch/';\n    let stringOptions = [];\n\n    // Handle common Cloudinary options\n    if (options.width) {\n      stringOptions.push(`w_${options.width}`);\n    }\n    if (options.height) {\n      stringOptions.push(`h_${options.height}`);\n    }\n    if (options.quality) {\n      stringOptions.push(`q_${options.quality}`);\n    }\n    if (options.crop) {\n      stringOptions.push(`c_${options.crop}`);\n    }\n    if (options.format) {\n      stringOptions.push(`f_${options.format}`);\n    }\n    if (options.colorize) {\n      stringOptions.push(`e_colorize:${options.colorize}`);\n    }\n    if (options.color) {\n      stringOptions.push(`co_rgb:${options.color}`);\n    }\n    if (options.gravity) {\n      stringOptions.push(`g_${options.gravity}`);\n    }\n\n    // Fix remote urls\n    url = url.replace(/^\\/\\//, 'http://');\n\n\n    return `${baseUrl}${stringOptions.join(',')}/${url}`;\n  },\n  transformItem(data) {\n    // Main color\n    let mainColorHexa = _.get(data, 'mainColor.hexa');\n    let mainColorRgb = null;\n    if (mainColorHexa) {\n      mainColorRgb = `${data.mainColor.red},${data.mainColor.green},${data.mainColor.blue}`;\n    }\n\n    // Thumbnail\n    let thumbnail = _.get(data, 'images.thumbnail');\n    if (thumbnail) {\n      thumbnail = Marvel.cloudinary(thumbnail, {\n        width: 200,\n        quality: 90,\n        crop: 'scale',\n        format: 'auto'\n      });\n    } else {\n      thumbnail = './img/hit-default.jpg';\n    }\n\n    // Background image\n    let background = _.get(data, 'images.background');\n    if (background) {\n      let backgroundOptions = {\n        width: 450,\n        quality: 90,\n        crop: 'scale',\n        format: 'auto'\n      };\n      if (mainColorHexa) {\n        backgroundOptions = {\n          ...backgroundOptions,\n          colorize: 40,\n          color: mainColorHexa\n        };\n      }\n      background = Marvel.cloudinary(background, backgroundOptions);\n    } else {\n      background = './img/profile-bg-default.gif';\n    }\n\n    // Background image for profile\n    let backgroundProfile = _.get(data, 'images.background');\n    if (backgroundProfile) {\n      let backgroundProfileOptions = {\n        width: 600,\n        quality: 90,\n        crop: 'scale',\n        format: 'auto'\n      };\n      if (mainColorHexa) {\n        backgroundProfileOptions = {\n          ...backgroundProfileOptions,\n          colorize: 40,\n          color: mainColorHexa\n        };\n      }\n      backgroundProfile = Marvel.cloudinary(backgroundProfile, backgroundProfileOptions);\n    } else {\n      backgroundProfile = './img/profile-bg-default.gif';\n    }\n\n    // All items are defered loading their images until in viewport, except\n    // the 4 first\n    let inViewport = false;\n    if (Marvel.lazyloadCounter === undefined || Marvel.lazyloadCounter < 4) {\n      inViewport = true;\n    }\n    Marvel.lazyloadCounter++;\n\n    let displayData = {\n      uuid: data.objectID,\n      name: data.name,\n      description: data.description,\n      highlightedName: Marvel.getHighlightedValue(data, 'name'),\n      highlightedDescription: Marvel.getHighlightedValue(data, 'description'),\n      inViewport,\n      mainColorRgb,\n      mainColorHexa,\n      thumbnail,\n      background,\n      // Used by the profile only\n      backgroundProfile,\n      urls: data.urls,\n      teams: data.teams,\n      powers: data.powers,\n      species: data.species,\n      authors: data.authors\n    };\n\n    return {\n      ...displayData,\n      json: JSON.stringify(displayData)\n    };\n  },\n  transformProfileData(data) {\n    // Enhance facets (isRefined, hasType)\n    let facetNames = ['teams', 'powers', 'species', 'authors'];\n\n    // Keep record of current filters\n    let refinements = {};\n    _.each(facetNames, (facetName) => {\n      let facetRefinements = Marvel.search.helper.getRefinements(facetName);\n      refinements[facetName] = _.map(facetRefinements, (refinement) => {\n        return refinement.value;\n      });\n    });\n\n    // Create an array of objects for each facet name\n    let facets = {};\n    _.each(facetNames, (facetName) => {\n      facets[facetName] = _.map(data[facetName], (facetValue) => {\n        return {\n          value: facetValue,\n          isRefined: _.includes(refinements[facetName], facetValue)\n        };\n      });\n    });\n\n    // Get an object to tell us if the character has values for this facets\n    let hasFacets = _.mapValues(facets, (value, key) => {\n      return key.length > 0;\n    });\n\n    let profileData = {\n      uuid: data.uuid,\n      name: data.name,\n      description: data.description,\n      facets,\n      hasFacets,\n      urls: data.urls,\n      mainColorHexa: data.mainColorHexa,\n      thumbnail: data.thumbnail,\n      background: data.backgroundProfile\n    };\n\n    console.info(profileData);\n\n    return profileData;\n  },\n  getHighlightedValue(object, property) {\n    if (!_.has(object, `_highlightResult.${property}.value`)) {\n      return object[property];\n    }\n    return object._highlightResult[property].value;\n  },\n  // Enable lazyloading of images below the fold\n  onRender() {\n    let hits = $('.hit');\n    function onVisible(hit) {\n      $(hit).addClass('hit__inViewport');\n    }\n    _.each(hits, (hit) => {\n      inViewport(hit, {offset: 50}, onVisible);\n    });\n  },\n  addSearchBoxWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.searchBox({\n        container: '#q',\n        placeholder: 'Search for any character, power, secret identity'\n      })\n    );\n  },\n  addStatsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.stats({\n        container: '#stats'\n      })\n    );\n  },\n  addTeamsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#teams',\n        attributeName: 'teams',\n        operator: 'and',\n        limit: 10,\n        sortBy: ['isRefined', 'count:desc', 'name:asc'],\n        showMore: {\n          limit: 20\n        }\n      })\n    );\n  },\n  addPowersWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#powers',\n        attributeName: 'powers',\n        operator: 'and',\n        limit: 10,\n        sortBy: ['isRefined', 'count:desc', 'name:asc'],\n        showMore: {\n          limit: 20\n        }\n      })\n    );\n  },\n  addAuthorsWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#authors',\n        attributeName: 'authors',\n        operator: 'and',\n        limit: 10,\n        sortBy: ['isRefined', 'count:desc', 'name:asc'],\n        showMore: {\n          limit: 20\n        }\n      })\n    );\n  },\n  addSpeciesWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.refinementList({\n        container: '#species',\n        attributeName: 'species',\n        operator: 'or',\n        limit: 10,\n        sortBy: ['isRefined', 'count:desc', 'name:asc']\n      })\n    );\n  },\n  addHitsWidget() {\n    let hitTemplate = $('#hitTemplate').html();\n    let emptyTemplate = $('#noResultsTemplate').html();\n    this.search.addWidget(\n      instantsearch.widgets.hits({\n        container: '#hits',\n        hitsPerPage: 10,\n        templates: {\n          empty: emptyTemplate,\n          item: hitTemplate\n        },\n        transformData: {\n          item: Marvel.transformItem\n        }\n      })\n    );\n  },\n  addPaginationWidget() {\n    this.search.addWidget(\n      instantsearch.widgets.pagination({\n        container: '#pagination',\n        labels: {\n          previous: '‹ Previous',\n          next: 'Next ›'\n        },\n        showFirstLast: false\n      })\n    );\n  },\n  addRefinementList() {\n    this.search.addWidget(\n      instantsearch.widgets.currentRefinedValues({\n        container: '#current-refined-values',\n        clearAll: 'before'\n      })\n    );\n  },\n  addOpenProfile() {\n    let container = $('.js-container');\n    let template = Hogan.compile($('#profileTemplate').html());\n    let profile = $('.js-profile');\n    function closeProfile() {\n      container.removeClass('l-container__withProfile');\n    }\n\n    // Clicking a result will open the profile, render the template and put it\n    // in the profile\n    $('.hits').on('click', '.hit', (event) => {\n      container.addClass('l-container__withProfile');\n      let hit = event.currentTarget;\n      let json = $(hit).find('.js-hit--json-holder').text();\n      let data = Marvel.transformProfileData(JSON.parse(json));\n      profile.html(template.render(data));\n    });\n\n    // Let users close it\n    profile.on('click', '.js-profile--close', closeProfile);\n\n    // Let user add/remove refinements when clicking on it\n    profile.on('click', '.js-profile--facet', (_event) => {\n      let target = $(_event.currentTarget);\n      let facetName = target.data('facet-name');\n      let facetValue = target.text();\n      this.search.helper.toggleRefinement(facetName, facetValue).search();\n      target.toggleClass('profile--facet__isRefined');\n    });\n  }\n};\n\nexport default Marvel;\n"]}